<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <link rel="stylesheet" href="/Styles/styles.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
       <script src="/javascript/funciones_login.js" type="text/javascript"></script>
       <script src="/javascript/funcionesflat.js" type="text/javascript"></script>
</head>

<input type="text" id="usuario" hidden>
<body onload="DefinirUsuario();">


    <div class="header">
        <div>
            <img class="logo-s" src="/img/logo.svg" alt="">
        </div>
        <div class="nav">
            <a id="resultadoNombre" class="fa fa-user" style='font-size:20px'></a>
            <a href="./Home.html" >Inicio</a>
            <a href="./All_Flats.html" >Mis Bienes</a>
            <a href="./New_Flats.html" >Registrar Nuevo Bien</a>
            <a href="./Profile_Update.html" >Editar Perfil</a>
            <a href="/html/Login.html" onclick="cerrarSesion()" class="fa fa-share-square" style='font-size:20px'>Cerrar Sesion</a>
        </div>
    </div>

        <img class="img-fondo" src="/img/casa1.webp" alt="">

    <div id="mensaje" hidden></div>


    <script>
        var DefinirUsuario = function() {
            const usuario = localStorage.getItem('usuarioLogeado');
            if (usuario) {
                document.getElementById('mensaje').innerHTML = " " + usuario;
                document.getElementById('resultadoNombre').innerHTML = " " + localStorage.getItem('NombreLogueado');
                document.getElementById('usuario').value = usuario;


            } else {
               
                alert("**No hay usuario Logueado**");
                document.location.href = 'Login.html';
            }
        }
        // Llamar a la función cuando el documento esté completamente cargado
        document.addEventListener('DOMContentLoaded', (event) => {
            DefinirUsuario();
        });
    </script>

        <h2>Bienes Favoritos</h2>
        <table border="1" id="tablaFlats">
            <thead>
                <tr>
                    <th>Ciudad</th>
                    <th>Dirección</th>
                    <th>Numero de lote</th>
                    <th>Area construcción</th>
                    <th>Aire Acondicionado</th>
                    <th>Precio arrendamiento</th>
                    <th>Fecha disponibilidad de arriendo</th>
                    <th>Favorito?</th>    
                    </tr>
            </thead>
            <tbody>
                <!-- Los datos se llenarán dinámicamente -->
            </tbody>
        </table>


        <script>
            // Función para cargar los datos del localStorage y mostrarlos en la tabla
            function cargarFavoritos() {
                // Recuperar los datos de localStorage
                const datosJSON = localStorage.getItem('flatsFavoritos');
                const datos = datosJSON ? JSON.parse(datosJSON) : [];
    
                // Referencia a la tabla
                const tabla = document.getElementById('tablaFlats').getElementsByTagName('tbody')[0];
                tabla.innerHTML = ''; // Limpiar la tabla
    
                // Llenar la tabla con los datos
                datos.forEach((dato, indice) => {
                    const fila = tabla.insertRow();
                    fila.insertCell(0).textContent = dato.city;
                    fila.insertCell(1).textContent = dato.streetnumber;
                    fila.insertCell(2).textContent = dato.streetname;
                    fila.insertCell(3).textContent = dato.size;
                    fila.insertCell(4).textContent = dato.ac;
                    fila.insertCell(5).textContent = dato.price;
                    fila.insertCell(6).textContent = dato.date;

    
                    // Crear botón de eliminar
                    const botonEliminar = document.createElement('button');
                    botonEliminar.textContent = '❌';
                    botonEliminar.onclick = () => eliminarFavorito(indice);
                    fila.insertCell(7).appendChild(botonEliminar);
                });
            }
    
            // Función para eliminar un elemento de favoritos y actualizar localStorage
            function eliminarFavorito(indice) {
                // Recuperar los datos de localStorage
                const datosJSON = localStorage.getItem('flatsFavoritos');
                const datos = datosJSON ? JSON.parse(datosJSON) : [];
    
                // Eliminar el elemento del array
                datos.splice(indice, 1);
    
                // Guardar los datos actualizados en localStorage
                localStorage.setItem('flatsFavoritos', JSON.stringify(datos));
    
                alert('**Bien eliminado de favoritos**');
                cargarFavoritos(); // Recargar la tabla
            }
    
            // Llamar a la función cargarDatos cuando la página se cargue
            window.onload = cargarFavoritos;
        </script>

</body>
</html>